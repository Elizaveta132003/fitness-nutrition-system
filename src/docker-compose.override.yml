version: '3.4'

services:
    calories:
        ports:
            - 6001:80
        restart: unless-stopped
        environment:
            - ASPNETCORE_ENVIRONMENT=Docker

    nutrition:
        ports:
            - 7001:80
        restart: unless-stopped
        environment:
            - ASPNETCORE_ENVIRONMENT=Docker

    workouts:
        ports:
            - 8001:80
        restart: unless-stopped
        environment:
            - ASPNETCORE_ENVIRONMENT=Docker

    identity:
        ports:
            - 9001:80
        restart: unless-stopped
        environment:
            - ASPNETCORE_ENVIRONMENT=Docker

    reactclient:
        ports:
            - 3000:3000
        restart: unless-stopped
        environment:
            - ASPNETCORE_ENVIRONMENT=Docker
            
    mongodb:
        ports:
            - 27017:27017
        environment:
            - MONGO_INITDB_ROOT_USERNAME=root
            - MONGO_INITDB_ROOT_PASSWORD=mongo123
        restart: unless-stopped

    kibana:
        ports:
            - 5601:5601
        environment:
            - ELASTICSEARCH_URL:http://localhost:9200

    elasticsearch:
        ports:
            - 9200:9200
        environment: 
            - xpack.security.enabled=false
            - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
            - discovery.type=single-node
        volumes:
            - elasticsearch-data:/usr/share/elasticsearch/data
            
    gateway:
        ports:
            - 5001:80
        restart: unless-stopped
        environment:
            - ASPNETCORE_ENVIRONMENT=Docker
    sqlserver:
        ports:
            - 1433:1433
        environment:
            - ACCEPT_EULA=Y
            - MSSQL_SA_PASSWORD=Passw0rd
        restart: unless-stopped
    zookeeper:
        ports:
            - 2181:2181
        environment:
            ZOOKEEPER_CLIENT_PORT: 2181
            ZOOKEEPER_TICK_TIME: 2000
    kafka:
        ports:
            - 9092:9092
        environment:
            KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
            KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://kafka:29092,PLAINTEXT_HOST://localhost:9092
            KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: PLAINTEXT:PLAINTEXT,PLAINTEXT_HOST:PLAINTEXT
            KAFKA_INTER_BROKER_LISTENER_NAME: PLAINTEXT
            KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1
            KAFKA_LOG_CLEANER_DELETE_RETENTION_MS: 5000
            KAFKA_BROKER_ID: 1
            KAFKA_MIN_INSYNC_REPLICAS: 1
    kafdrop:
        ports:
            - 9000:9000
        environment:
            KAFKA_BROKERCONNECT: kafka:29092   
    redis:
        ports: 
            - 6379:6379
        environment:
            - ALLOW_EMPTY_PASSWORD=yes
        restart: unless-stopped
        
volumes:   
  elasticsearch-data:
